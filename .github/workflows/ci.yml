name: CI Tests

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - uses: actions/setup-python@v5
      with:
        python-version: "3.11"

    - name: Install project with all dependencies
      run: |
        pip install --upgrade pip
        # Check if requirements.txt exists
        if [ -f requirements.txt ]; then
          echo "Installing from requirements.txt"
          pip install -r requirements.txt
        else
          echo "No requirements.txt found, installing common dependencies"
          pip install numpy pytest
        fi
        
        # Install the project in development mode
        python -m pip install -e .

    - name: Install missing test dependencies
      run: |
        # Install starlette for backend tests
        pip install starlette
        # Install pyttsx3 for TTS tests
        pip install pyttsx3
        # Install anyio for async tests
        pip install anyio

    - name: Run audio tests only
      run: |
        pytest tests/audio/ -v
        
    - name: Run all tests (including backend)
      run: |
        pytest tests/ -v
